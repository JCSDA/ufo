file(MAKE_DIRECTORY "${CMAKE_CURRENT_BINARY_DIR}/testinput")
execute_process( COMMAND ${CMAKE_COMMAND} -E create_symlink
  "${CMAKE_CURRENT_SOURCE_DIR}/testinput/autogenerated.yaml"
  "${CMAKE_CURRENT_BINARY_DIR}/testinput/autogenerated.yaml")

file(MAKE_DIRECTORY "${CMAKE_CURRENT_BINARY_DIR}/Data")
# Note: can't use filters_testdata.nc4 since it doesn't contain latitudes or longitudes.
execute_process( COMMAND ${CMAKE_COMMAND} -E create_symlink
  "${CMAKE_CURRENT_SOURCE_DIR}/../../../test/testinput/filters/poisson_disk_thinning_3x3x3x3_regular_grid.nc4"
  "${CMAKE_CURRENT_BINARY_DIR}/Data/poisson_disk_thinning_3x3x3x3_regular_grid.nc4")

# Test the generated operator.
ecbuild_add_test(TARGET  test_ufo_opr_autogenerated
                 SOURCES "${CMAKE_CURRENT_SOURCE_DIR}/../../../test/mains/TestObsOperator.cc"
                         $<TARGET_OBJECTS:obsautogenerated>
                 ARGS    "testinput/autogenerated.yaml"
                 ENVIRONMENT OOPS_TRAPFPE=1
                 LIBS    ufo)

# (We can't test the linear operator as long as its implementation is empty, since the test
# expects its output to vary as a function of input data.)
