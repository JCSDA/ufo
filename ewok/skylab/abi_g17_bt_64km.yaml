obs space:
  name: abi_g17_bt_64km
  obsdatain:
    engine:
      type: H5File
  obsdataout:
    engine:
      type: H5File
      allow overwrite: true
  io pool:
    write multiple files: true
  _source: noaa
  simulated variables: [brightnessTemperature]
  channels: &abi_g17_channels 7, 8, 9, 10, 11, 12, 13, 14, 15, 16
obs operator:
  name: CRTM
  Absorbers: [H2O, O3] #, CO2]
  Clouds: [Water, Ice, Snow]
  Cloud_Fraction: 1.0
  obs options:
    Sensor_ID: abi_gr # For now, using GOES-R coefficients instead of GOES-17
    EndianType: little_endian
monitoring only: true
obs bias:
  variational bc:
    predictors:
    - name: constant
    - name: emissivity
    - name: scan_angle
      order: 4
    - name: scan_angle
      order: 3
    - name: scan_angle
      order: 2
    - name: scan_angle
  covariance:
    minimal required obs number: 20
    variance range: [1.0e-6, 10.0]
    step size: 1.0e-4
    largest analysis variance: 10000.0
    prior:
      inflation:
        ratio: 1.1
        ratio for small dataset: 2.0
obs filters:
## Data Quality Flags (DQF) from original data are in PreQC (0=good, 1=conditionally_usable, 2 or 3 are bad) # TODO: activate it back when files change PreQC to be integer
#- filter: PreQC
#  maxvalue: 1
#  action:
#    name: reject
# Reject observation points that are towards the limb of the satellite view.
- filter: RejectList
  filter variables:
  - name: brightnessTemperature
    channels: *abi_g17_channels
  where:
  - variable:
      name: MetaData/sensorZenithAngle
    minvalue: 69.0
  action:
    name: reject
# Gross check the brightness temperatures are physically sensible.
- filter: Bounds Check
  filter variables:
  - name: brightnessTemperature
    channels: *abi_g17_channels
  minvalue: 130
  maxvalue: 335
  action:
    name: reject
# Assign observation errors.
- filter: Perform Action
  filter variables:
  - name: brightnessTemperature
    channels: *abi_g17_channels
  action:
    name: assign error
    error parameter vector: [6.5, 4.5, 4.0, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5]
# Gross error check with (O - B) / ObsError greater than threshold.
- filter: Background Check
  filter variables:
  - name: brightnessTemperature
    channels: *abi_g17_channels
  threshold: 4.0
  absolute threshold: 25.0
  action:
    name: reject
# Decide which channels we wish to ignore (-1) or use (1).
- filter: Bounds Check
  filter variables:
  - name: brightnessTemperature
    channels: *abi_g17_channels
  test variables:
  - name: ObsFunction/ChannelUseflagCheckRad
    channels: *abi_g17_channels
    options:
      channels: *abi_g17_channels
      use_flag: [-1, 1, 1, 1, -1, -1, 1, 1, 1, 1]
  minvalue: 1.0e-12
  action:
    name: reject
