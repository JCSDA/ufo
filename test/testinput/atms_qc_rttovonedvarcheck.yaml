---
logging:
  categories: Warning, Error, Debug
test_framework_runtime_config: "--log_level=test_suite"

window_begin: &win_begin 2019-11-26T21:00:00Z
window_end: &win_end 2019-11-27T03:00:00Z

LinearObsOpTest: 
 coefTL: 1.e-5
 toleranceTL: 1.0e-5
 toleranceAD: 1.0e-11

Observations:
  ObsTypes:
  - ObsOperator:
      name: RTTOV
      ObsOptions:
        Sensor_ID: noaa_20_atms
        CoefficientPath: &rttov_coeff Data/
        mw_clw: true
      ExtraVars:
        - mass_content_of_cloud_liquid_water_in_atmosphere_layer
        - mass_content_of_cloud_ice_in_atmosphere_layer
    GeoVaLs:
      filename: Data/atms_allsats_geoval_2019112700-init.nc4
    ObsSpace: 
      name: Radiance
      ObsDataIn:
        obsfile: &obs_file Data/atms_allsats_obs_2019112700-init.nc4
      ObsDataOut: 
        obsfile: Data/atms_allsats_obs_2019112700-out.nc4
      simulate:
        variables: [brightness_temperature]
        channels: &ops_channels 6-15, 18-22
    ObsFilters:
#   Blacklisting represents channel rejection which will be rejected 
#   by other filters eventually and qc_info will not be used.
    - Filter: BlackList
      filter variables:
      - name: brightness_temperature
        channels: 6
      where:
      - variable:
          name: qc_info@MetaData
        minvalue: 8396930.0
        maxvalue: 8618514.0
      action:
        name: reject
    - Filter: BlackList
      filter variables:
      - name: brightness_temperature
        channels: 7-8
      where:
      - variable:
          name: qc_info@MetaData
        minvalue: 8397185.5
        maxvalue: 8397186.5
    - Filter: BlackList
      filter variables:
      - name: brightness_temperature
        channels: 7-8
      where:
      - variable:
          name: qc_info@MetaData
        minvalue: 8486913.5
        maxvalue: 8618514.5
      action:
        name: reject
    - Filter: BlackList
      filter variables:
      - name: brightness_temperature
        channels: 9
      where:
      - variable:
          name: qc_info@MetaData
        minvalue: 8397185.5
        maxvalue: 8397186.5
      action:
        name: reject
    - Filter: BlackList
      filter variables:
      - name: brightness_temperature
        channels: 9
      where:
      - variable:
          name: qc_info@MetaData
        minvalue: 8528257.5
        maxvalue: 8528642.5
      action:
        name: reject
    - Filter: BlackList
      filter variables:
      - name: brightness_temperature
        channels: 18
      where:
      - variable:
          name: qc_info@MetaData
        minvalue: 8396803
      action:
        name: reject
    - Filter: BlackList
      filter variables:
      - name: brightness_temperature
        channels: 19,20
      where:
      - variable:
          name: qc_info@MetaData
        minvalue: 8396817
        maxvalue: 8396819
      action:
        name: reject
    - Filter: BlackList
      filter variables:
      - name: brightness_temperature
        channels: 19
      where:
      - variable:
          name: qc_info@MetaData
        minvalue: 8397185
      action:
        name: reject
    - Filter: BlackList
      filter variables:
      - name: brightness_temperature
        channels: 20
      where:
      - variable:
          name: qc_info@MetaData
        minvalue: 8396945
        maxvalue: 8397187
      action:
        name: reject
    - Filter: BlackList
      filter variables:
      - name: brightness_temperature
        channels: 20
      where:
      - variable:
          name: qc_info@MetaData
        minvalue: 8421393
      action:
        name: reject
    - Filter: BlackList
      filter variables:
      - name: brightness_temperature
        channels: 21-22
      where:
      - variable:
          name: qc_info@MetaData
        minvalue: 8397185
        maxvalue: 8397187
      action:
        name: reject
    - Filter: BlackList
      filter variables:
      - name: brightness_temperature
        channels: 21-22
      where:
      - variable:
          name: qc_info@MetaData
        minvalue: 8421889
      action:
        name: reject
    - Filter: RTTOV OneDVar Check
      applyfilter: 
      - name: post@HofX
      ModName: RTTOV
      ObsOptions:
        Sensor_ID: noaa_20_atms
        CoefficientPath: *rttov_coeff
      variables: [brightness_temperature]
      channels: *ops_channels
      retrieval_variables:
      - air_temperature
      - specific_humidity
      - air_temperature_at_two_meters_above_surface
      - specific_humidity_at_two_meters_above_surface
      - skin_temperature
      - surface_air_pressure
      BMatrix: Data/atms_bmatrix_70.dat
      nlevels: 70
      rtype: diagonal # diagonal or full R matrix
      qtotal: true
      RTTOV_mwscattSwitch: false
      UseMLMinimization: false
      UseJforConvergence: true
      FullDiagnostics: true
      JConvergenceOption: 1
      ConvergenceFactor: 0.40
      Cost_ConvergenceFactor: 0.01
      Max1DVarIterations: 7
      ReadMWemiss: true
      ReadIRemiss: false
      EmissLandDefault: 0.95
      EmissSeaIceDefault: 0.92
    passedBenchmark: 973      # number of passed obs
